<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/fragments/head :: head"></head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <header th:replace="admin/fragments/header :: header"></header>

    <!-- =============================================== -->

    <!-- Left rside column. contains the sidebar -->
    <aside th:replace="admin/fragments/sidebar :: sidebar"></aside>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">


        <div class="container">
            <h2>Danh s√°ch kh√°ch h√†ng</h2>
            <!-- Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu c√≥ -->
            <div th:if="${message}" th:class="'alert ' + ${messageType}">
                <span th:text="${message}"></span>
                <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>

            <div class="toolbar">

                <!-- Thanh t√¨m ki·∫øm -->
                <div class="search-container">
                    <form th:action="@{/customers}" method="get">
                        <input type="text" name="keyword" placeholder="Nh·∫≠p t√™n ho·∫∑c s·ªë ƒëi·ªán tho·∫°i..." th:value="${keyword}">
                        <button type="submit">üîçT√¨m ki·∫øm</button>
                    </form>
                </div>
                <div class="filter-container">
                    <form th:action="@{/customers}" method="get">
                        <select name="addressFilter">
                            <option value="">Ch·ªçn ƒë·ªãa ch·ªâ</option>
                            <option th:each="address : ${addressList}" th:value="${address}" th:text="${address}"></option>
                        </select>
                        <button type="submit">üîçL·ªçc</button>
                    </form>
                </div>
                <!-- N√∫t m·ªü form th√™m kh√°ch h√†ng -->
                <div class="add-button">
                    <button class="btn-add" onclick="toggleFormAdd()">‚ûï Th√™m kh√°ch h√†ng</button>
                </div>

            </div>




            <!-- Form th√™m kh√°ch h√†ng (·∫®n ban ƒë·∫ßu) -->
            <div id="addCustomerForm" style="display: none;">
                <h3>Th√™m kh√°ch h√†ng m·ªõi</h3>
                <form th:action="@{/customers/add}" th:object="${customer}" method="post">
                    <label for="name">T√™n kh√°ch h√†ng:</label>
                    <input type="text" id="name" th:field="*{name}" required>

                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="text" id="phone" th:field="*{phone}" required>

                    <label for="address">ƒê·ªãa ch·ªâ:</label>
                    <input type="text" id="address" th:field="*{address}" required>

                    <label for="debtBalance">C√¥ng n·ª£:</label>
                    <input type="number" id="debtBalance" th:field="*{debtBalance}" step="0.01" required min="0">
                    <label for="address">Ghi ch√∫:</label>
                    <input type="text" id="note" th:field="*{note}" required>

                    <button type="submit" class="btn">Th√™m kh√°ch h√†ng</button>
                    <button type="button" class="btn cancel" onclick="toggleFormAdd()">H·ªßy</button>
                </form>
            </div>

            <!-- B·∫£ng danh s√°ch kh√°ch h√†ng -->
            <table>
                <thead>
                <tr>

                    <th>T√™n kh√°ch h√†ng</th>
                    <th>S·ªë ƒëi·ªán tho·∫°i</th>
                    <th>ƒê·ªãa ch·ªâ</th>
                    <th>C√¥ng n·ª£</th>
                    <th>Ghi ch√∫</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="customer : ${customers}">

                    <td th:text="${customer.name}"></td>
                    <td th:text="${customer.phone}"></td>
                    <td th:text="${customer.address}"></td>
                    <td th:text="${customer.debtBalance}"></td>
                    <td th:text="${customer.note}"></td>
                    <td class="action-links">
                        <button class="edit"
                                th:attr="onclick=|toggleFormEdit('${customer.id}', '${customer.name}', '${customer.phone}', '${customer.address}', '${customer.debtBalance}' , '${customer.note}')|">
                            S·ª≠a
                        </button>
                        <a th:href="@{/customers/delete/{id}(id=${customer.id})}" class="delete"
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng n√†y?')">X√≥a</a>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- Ph√¢n trang -->
            <div class="pagination">
                <span th:if="${currentPage > 0}">
                    <a th:href="@{/customers(page=${currentPage - 1}, size=${size}, keyword=${keyword})}">¬´ Trang tr∆∞·ªõc</a>
                </span>
                <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a th:href="@{/customers(page=${i}, size=${size}, keyword=${keyword})}"
                       th:text="${i + 1}" th:classappend="${i == currentPage} ? 'active' : ''"></a>
                </span>
                <span th:if="${currentPage < totalPages - 1}">
                    <a th:href="@{/customers(page=${currentPage + 1}, size=${size}, keyword=${keyword})}">Trang sau ¬ª</a>
                </span>
            </div>
            <div id="editCustomerForm" style="display: none;">
                <h3>S·ª≠a kh√°ch h√†ng</h3>
                <form th:action="@{/customers/edit}" method="post">
                    <input type="hidden" id="editId" name="id">

                    <label for="editName">T√™n kh√°ch h√†ng:</label>
                    <input type="text" id="editName" name="name" required>

                    <label for="editPhone">S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="text" id="editPhone" name="phone" required>

                    <label for="editAddress">ƒê·ªãa ch·ªâ:</label>
                    <input type="text" id="editAddress" name="address" required>

                    <label for="editDebtBalance">C√¥ng n·ª£:</label>
                    <input type="number" id="editDebtBalance" name="debtBalance" step="0.01" required>

                    <label for="editNote">Ghi ch√∫:</label>
                    <input type="text" id="editNote" name="note" required>

                    <button type="submit" class="btn">L∆∞u thay ƒë·ªïi</button>
                    <button type="button" class="btn cancel" onclick="closeEditForm()">H·ªßy</button>
                </form>
            </div>

        </div>
    </div>
    <!-- /.content-wrapper -->
    <footer th:replace="admin/fragments/footer :: footer"></footer>

</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
            let alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.style.display = 'none', 500); // ·∫®n sau khi hi·ªáu ·ª©ng m·ªù d·∫ßn k·∫øt th√∫c
            });
        }, 3000); // 3 gi√¢y
    });
</script>

<!-- ./wrapper -->

<!-- jQuery 3 -->
<div th:replace="admin/fragments/script :: script"></div>
</body>
</html>
